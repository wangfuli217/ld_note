防火墙调研
一、防火墙基本概念
1. 防火墙是什么？

防火墙最基本的功能就是隔离网络，通过将网络划分成不同的区域（通常情况下称为ZONE），制定出不同区域之间的访问控制策略来控制不同信任程度区域间传送的数据流。例如互联网是不可信任的区域，而内部网络是高度信任的区域。以避免安全策略中禁止的一些通信。它有控制信息基本的任务在不同信任的区域。 典型信任的区域包括互联网(一个没有信任的区域) 和一个内部网络(一个高信任的区域) 。 最终目标是提供受控连通性在不同水平的信任区域通过安全政策的运行和连通性模型之间根据最少特权原则。
2. 防火墙的类型

防火墙有不同类型。一个防火墙可以是硬件自身的一部分，你可以将因特网连接和计算机都插入其中。防火墙也可以在一个独立的机器上运行，该机器作为它背后网络中所有计算机的代理和防火墙。最后，直接连在因特网的机器可以使用个人防火墙。

从防火墙的软、硬件形式来分的话，防火墙可以分为软件防火墙和硬件防火墙以及芯片级防火墙。
2.1 软件防火墙

运行于特定的计算机上，它需要客户预先安装好的计算机操作系统的支持，一般来说这台计算机就是整个网络的网关。俗称“个人防火墙”。软件防火墙就像其它的软件产品一样需要先在计算机上安装并做好配置才可以使用。例如iptables、安全狗、赛门铁克等。
2.2 硬件防火墙

基于硬件平台的网络防预系统，与芯片级防火墙相比并不需要专门的硬件。目前市场上大多数防火墙都是这种硬件防火墙，他们基于PC架构。
2.3 芯片级防火墙

基于专门的硬件平台，没有操作系统。专有的ASIC芯片促使它们比其他种类的防火墙速度更快，处理能力更强，性能更高。例如NetScreen、FortiNet、Cisco、Juniper等。这类防火墙由于是专用OS（操作系统），防火墙本身的漏洞比较少，不过价格相对比较高昂。
3. 防火墙特性

    内部网络和外部网络之间的所有网络数据流都必须经过防火墙
    只有符合安全策略的数据流才能通过防火墙
    防火墙自身应具有非常强的抗攻击免疫力

4.为什么需要防火墙？

网络攻击、入侵破坏事件日益严重，组织单位需要一套有效的安全性防御技术，组织单位需要一个集中管理安全性政策的机制。组织单位需要集中的核实记录所有的进出的流量，以便于时候的安全性核查与分析。

防火墙无意识打成上述安全性要求，保护组织单位网络最有效的方式之一。 enter image description here

    防火墙是汽车中一个部件的名称。在汽车中，利用防火墙把乘客和引擎隔开，以便汽车引擎一旦著火，防火墙不但能保护乘客安全，而同时还能让司机继续控制引擎。再电脑术语中，当然就不是这个意思了，我们可以类比来理解，在网络中，所谓“防火墙”，是指一种将内部网和公众访问网(如Internet)分开的方法，它实际上是一种隔离技术。防火墙是在两个网络通讯时执行的一种访问控制尺度，它能允许你 “同意”的人和数据进入你的网络，同时将你“不同意”的人和数据拒之门外，最大限度地阻止网络中的黑客来访问你的网络。换句话说，如果不通过防火墙，公司内部的人就无法访问Internet，Internet上的人也无法和公司内部的人进行通信。

4. 防火墙运行原理

enter image description here
二、介绍
1. 硬件
1.1 Juniper是什么？

Juniper Networks（公司中文名称：瞻博网络，NYSE：JNPR）是一家网络通讯设备公司，创立于1996年2月，主要供应IP网络及资讯安全解决方案。Juniper Networks与爱立信、朗讯及西门子共同合作开发IP/MPLS网络解决方案以提供给客户。
1.2 安全产品

    NetScreen / Secure Service Gateway（SSG）系列：为硬件防火墙,并购自NetScreen公司。
    SRX系列：基于Junos的高性能防火墙。
    MAG (Junos Pulse Gateway)系列：整合Junos的SSL VPN闸道器的，硬件上取代SA系列，可转化为访问控制（Access Control）闸道器。
    IDP：为入侵侦测防御（Intrusion Detection & Prevention）设备。此类解决方案也常被称为入侵预防系统（IPS）。运用特征规则化的分析，对恶意的网络流量进行侦测及拦截。
    VF系列：为会话边界控制器（Session Border Controller），为网络语音VoIP流量提供了可扩充及安全的处理能力。

1.3 防火墙产品线

enter image description here
1.4 优势

    专用的硬件设计
    专用Junos操作系统
    多种管理方式(CLI、Web、集中管理)
    集成安全、路由、UTM、IDP特性
    入侵防御
    防病毒
    防垃圾邮件
    网页过滤
    灵活部署、扩展
    高可用

2. 软件
2.1 iptables是什么？

netfilter/iptables（简称为iptables）组成Linux平台下的包过滤防火墙，与大多数的Linux软件一样，这个包过滤防火墙是免费的，它可以代替昂贵的商业防火墙解决方案，完成封包过滤、封包重定向和网络地址转换（NAT）等功能。
2.2 优势

    开源软件
    内核集成
    状态追踪
    自定义规则
    信息包过滤
    四表五链
    内网防护
    主机隔离

2.3 技术特点
2.3.1 四表

    Filter表: 主要用于过滤数据包，该表根据系统管理员预定义的一组规则过滤符合条件的数据包。对于防火墙而言，主要利用在filter表中指定的规则来实现对数据包的过滤。
        INPUT
        OUTPUT
        FORWARD

    Nat表: 主要用于网络地址转换NAT,该表可以实现一对一,一对多,多对多等NAT 工作，iptables就是使用该表实现共享上网的。
        PREROUTING
        POSTROUTING
        OUTPUT

    Raw表: 只使用在PREROUTING链和OUTPUT链上,因为优先级最高，从而可以对收到的数据包在连接跟踪前进行处理。一但用户使用了RAW表,在 某个链上,RAW表处理完后,将跳过NAT表和 ip_conntrack处理,即不再做地址转换和数据包的链接跟踪处理了。
        PREROUTING
        OUTPUT
        FORWARD
        INPUT
        POSTROUTING
    Mangle表: 用于指定如何处理数据包,拆解报文,做出修改,封装报文。
        PREROUTING
        OUTPUT
        FORWARD
        INPUT
        POSTROUTING

2.3.2 五链

    INPUT链 – 处理来自外部的数据。
    OUTPUT链 – 处理向外发送的数据。
    FORWARD链 – 将数据转发到本机的其他网卡设备上。
    PREROUTING链 – 处理刚到达本机并在路由转发前的数据包。它会转换数据包中的目标IP地址(destination ip address),通常用于DNAT(destination NAT)。
    POSTROUTING链 - 处理即将离开本机的数据包.它会转换数据包中的源IP地址(source ip address),通常用于SNAT(source NAT)。

2.4 运行原理

enter image description here
三、综合分析

    功能：
        iptables：内置的四表五链规则功能强大,根据需要进行自定义配置。
        Juniper: 集成安全、路由、UTM、IDP特性、高可用等非常强大丰富的功能。

    性能
        iptables:主要依赖服务器的CPU和内存来实现防攻击的能力，在攻击严重的情况下可能大量占用服务器的资源，可能会造成网络的瓶颈、网络速度慢、上网带宽不够等等问题。
        Juniper: 专用设计的处理器和内存及和操作系统，防火墙程序做到芯片里面，由硬件执行服务器的防护功能，保证了稳定性和吞吐量。
    管理
        iptables: 入门学习难度大,配置复杂,人工配置出错几率大。
        Juniper: 有多种管理模式,便于维护人员的管理和后期的规则配置,功能繁多,有专业的资格证书。

    安全
        iptables：可以在依附于其他服务的主机上,可以防护内外网主机之间的通信安全。
        Juniper：独立的主机和操作系统,只能针对流入和流出的请求做安全监测机制,无法防范zone主机之间的通信安全。

    成本
        iptables：开源软件没有额外的成本开销，永久免费使用。
        Juniper：商业防火墙硬件提供商，根据业务规模价格不等，中小型公司使用的防火墙价格在7000-40000区间。